"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[56206],{192784:(t,e,s)=>{s.r(e),s.d(e,{flushDelegate:()=>r});const r=new(s(707957).Delegate)},62802:(t,e,s)=>{t=s.nmd(t),s(638456);var r=s(120780).fetch,a=s(868073).regExpEscape,n=s(226722).TVXWindowEvents,i=s(49437).TVLocalStorage,o=s(707957).Delegate,l=s(244842),h=s(125226).isFeatureEnabled,{flushDelegate:d}=s(192784),u=s(201089).getLogger("Lib.TVSettings"),c=["s.tradingview.com","betacdn.tradingview.com"],m=(l.enabled("use_localstorage_for_settings"),window.TVSettings=function(){var t=!1,e=null,s=!1;function _(){return!(e||window.is_authenticated)}try{t=!TradingView.onWidget()&&parent&&parent!==window&&!!parent.IS_DEMO_PAGE}catch(t){}if(t){var f={"widgetbar.layout-settings":{widgets:{},settings:{minimized:!0}},notShowMainWizard:!0},g=function(t,e,s){var r=f[t];return null==r?e:r},p=function(){};return{loaded:!1,loadedModel:!1,getValue:g,getJSON:g,getBool:g,getFloat:g,getInt:g,setValue:p,setJSON:p,remove:p,keys:function(){return Object.keys(f)},keysMask:function(){return[]},sync:p,onSync:{subscribe:function(){}}}}var b=12e4;"local"===window.environment&&(b=5e3);var y,v,w,S=TradingView.onWidget()?"tradingview-widget":"tradingview",x=S+".",I={},C=[],E=[/^widgetbar\.widget\.watchlist.+/,/.+quicks$/,/^widgetbar\.layout-settings$/,/^ChartSideToolbarWidget\.visible$/,/^onwidget\.watchlist$/,/^chart\.favoriteDrawings$/,/^chart\.favoriteDrawingsPosition$/,/^chart\.favoriteLibraryIndicators$/,/^loadChartDialog.favorites$/,/^ChartFavoriteDrawingToolbarWidget\.visible/,/^trading\.chart\.proterty$/,/^trading_floating_toolbar\.position$/,/^trading\.orderWidgetMode\./,/^symbolWatermark$/,/^pinereference\.size$/,/^pinereference\.position$/,/^hint\.+/,/^ChartDrawingToolbarWidget\.visible/];function M(t){return x+t}function N(t){return t.substring(x.length)}function k(t,e){var s=I[t];return null==s?e:s}function F(t,e,s){s=s||{};var r=""+e;return I[t]!==r&&(I[t]=r,D(t)),s.forceFlush&&!v&&(v=setTimeout((function(){v=void 0,R()}),10)),m}function T(t,e){return e=e||{},null!=I[t]&&(delete I[t],D(t)),e.forceFlush&&R(),m}function P(){y=void 0,C.length&&R()}function D(t){if(e)null==I[t]?e.removeValue(t):e.setValue(t,I[t]);else if(_())try{null==I[t]?i.removeItem(M(t)):i.setItem(M(t),I[t])}catch(t){}else C.push(t),y||(y=setTimeout(P,b));n.emit("settings",JSON.stringify({key:t,value:I[t]}))}function R(t){if(!s&&!w)if(h("disable_save_settings"))u.logWarn("Settings flashing has been skipped because of disable_save_settings featuretoggle");else if(!l.enabled("widget")&&!_()&&0!==C.length){var e=C;C=[];for(var a={},n=e.length;n--;){var i=e[n],o=I[i];void 0===o&&(o=null),a[i]=o}var d=new FormData;d.append("delta",JSON.stringify(a)),t&&navigator.sendBeacon?navigator.sendBeacon("/savesettings/",d):r("/savesettings/",{method:"POST",credentials:"include",body:d}).then((function(s){if(s.ok||(C=C.concat(e)),[429,503].includes(s.status)){var r=1e3*+s.headers.get("retry-after")||3e5;w=setTimeout((()=>{w=void 0,R(t)}),r)}})).catch((function(){C=C.concat(e)}))}}function L(){
return Object.keys(I)}function A(t){for(var e=0;e<E.length;++e)if(E[e].exec(t))return!0;return!1}function B(t){return t.substring(0,x.length)===x}function $(t){I={};const e=0===Object.keys(t).length;e||function(t){Object.keys(t).forEach((function(e){I[e]=t[e]+""}))}(t),function(t){for(var e=i.length;e--;){var s=i.key(e);s&&B(s)&&(t&&F(N(s),i.getItem(s)),i.removeItem(s))}}(e)}n.on("settings",(function(t){var e=JSON.parse(t);null==e.value?delete I[e.key]:I[e.key]=e.value}));var O=new o;return document.addEventListener("visibilitychange",(function(){"hidden"!==document.visibilityState&&!0!==document.hidden||R()})),window.addEventListener("pagehide",(function(){R(!0)})),window.addEventListener("beforeunload",(function(){R(!0)})),d.subscribe(null,(()=>{R()})),{loaded:!1,loadedModel:!1,getValue:k,getJSON:function(t,e){var s=k(t,void 0);if(null==s)return e;try{return JSON.parse(s)}catch(s){return T(t),e}},getBool:function(t,e){var s=k(t);return null==s?e:!(!s||"false"===s||0==+s)},getFloat:function(t,e,s){var r=k(t,void 0);if(null==r)return e;var a=parseFloat(r);if(!isFinite(a))throw new TypeError('"'+r+'" is not float (key: "'+t+'")');return a},getInt:function(t,e,s){var r=k(t,void 0);if(null==r)return e;var a=parseInt(r,10);if(!isFinite(a))throw new TypeError('"'+r+'" is not int (key: "'+t+'")');return a},setValue:F,setJSON:function(t,e,s){return F(t,JSON.stringify(e),s),m},remove:T,keys:L,keysMask:function(t,e){for(var s=L(),r=[],n=(t=new RegExp("^"+a(t).replace(/\\\*\\\*/gi,".+").replace(/\\\*/gi,"[^.]+")+"$","gi"),s.length-1);n>=0;n--)t.test(s[n])&&r.push(s[n]),t.lastIndex=0;return r},sync:function(t){null!==t?(e?$(e.initialSettings||{}):_()?(function(){if(TradingView.onWidget()&&c.includes(window.location.host))for(var t="tradingview.",e=i.length;e--;){var s=i.key(e);if(0===s.indexOf(t)){var r=s.replace(t,S+".");i.setItem(r,i.getItem(s)),i.removeItem(s)}}}(),function(){I={};for(var t=!l.enabled("save_chart_properties_to_local_storage"),e=i.length;e--;){var s=i.key(e);if(s&&B(s)){var r=s.substring(x.length);t&&!A(r)||(I[r]=i.getItem(s))}}}()):$(t||{}),O.fire()):s=!0},onSync:O,setSettingsAdapter:function(t){e=t}}}());setTimeout((function(){s.e(30362).then(s.bind(s,276141)).then((t=>{t.clearOldSettings()}))}),3e4),t&&t.exports&&(t.exports=m)},226722:(t,e,s)=>{s.d(e,{TVXWindowEvents:()=>i});s(586463);var r=s(201089),a=s(49437);const n=(0,r.getLogger)("XWindowEvents");var i;!function(t){const e="tvxwevents.",s={};let r;window.BroadcastChannel?(r=new BroadcastChannel("tvxwevents"),r.addEventListener("message",(function(t){const{data:{event:e,value:r}}=t;s[e]&&s[e].forEach((t=>{t(r)}))})),function(){const t=[],s=performance.now();for(let s=0;s<a.TVLocalStorage.length;s++){const r=a.TVLocalStorage.key(s);r.startsWith(e)&&t.push(r)}const r=a.TVLocalStorage.length;for(const e of t)a.TVLocalStorage.removeItem(e);const i=performance.now()-s;n.logNormal(`Total keys amount in local storage on operation start: ${r}`),n.logNormal(`Keys amount in local storage to be deleted: ${t.length}`),
n.logNormal(`Keys to be deleted from local storage: ${JSON.stringify(t)}`),n.logNormal(`Removing keys from local storage took ${i} ms`)}()):window.addEventListener("storage",(function(t){const{newValue:r,key:n}=t;if(null===r||!n||!n.startsWith(e))return;const i=n.substring(e.length);s[i]&&s[i].forEach((e=>{e(t.newValue)}));a.TVLocalStorage.removeItem(n)})),t.on=function(t,e){s[t]||(s[t]=[]),s[t].push(e)},t.off=function(t,e){if(!s[t])return;const r=s[t].indexOf(e);-1!==r&&(1===s[t].length?delete s[t]:s[t].splice(r,1))},t.emit=function(t,s=Date.now()){try{r?r.postMessage({event:t,value:s}):a.TVLocalStorage.setItem(e+t,s.toString())}catch(t){n.logError(t.message)}}}(i||(i={}))},674981:(t,e,s)=>{s.d(e,{lowerbound:()=>r,upperbound:()=>a});s(650151);function r(t,e,s,r=0,a=t.length){return function(t,e,s,r,a){let n=a-r;for(;0<n;){const a=n>>1,i=r+a;s(t(i),e)?(r=i+1,n-=a+1):n=a}return r}((e=>t[e]),e,s,r,a)}function a(t,e,s,r=0,a=t.length){let n=a-r;for(;0<n;){const a=n>>1,i=r+a;s(e,t[i])?n=a:(r=i+1,n-=a+1)}return r}},66732:(t,e,s)=>{s.d(e,{combine:()=>n});var r=s(401580);function a(t,e,...s){const a=(...e)=>t(...e.map((t=>t.value()))),n=new r.WatchedValue(a(...s)),i=()=>{e(...s.map((t=>t.value())))&&n.setValue(a(...s))},o=s.map((t=>t.spawn()));for(const t of o)t.subscribe(i);return n.readonly().spawn((()=>{o.forEach((t=>t.destroy())),s.forEach((t=>t.release()))}))}function n(t,...e){return a(t,(()=>!0),...e)}},551775:(t,e,s)=>{s.d(e,{customFormatters:()=>r});const r={dateFormatter:null,timeFormatter:null,tickMarkFormatter:null,priceFormatterFactory:null,studyFormatterFactory:null}},157954:(t,e,s)=>{s.d(e,{DateFormatter:()=>n});var r=s(551775),a=s(958067);class n{constructor(t="yyyy-MM-dd",e=!1){this._dateFormatFunc=e?(0,a.getDateFormatWithWeekday)(t):a.dateFormatFunctions[t]}format(t){return r.customFormatters&&r.customFormatters.dateFormatter?r.customFormatters.dateFormatter.format(t):this._dateFormatFunc(t,!1)}formatLocal(t){return r.customFormatters.dateFormatter?r.customFormatters.dateFormatter.formatLocal?r.customFormatters.dateFormatter.formatLocal(t):r.customFormatters.dateFormatter.format(t):this._dateFormatFunc(t,!0)}parse(t){if(""===t)return{res:!1};let e=t;return r.customFormatters&&r.customFormatters.dateFormatter&&!r.customFormatters.dateFormatter.parse&&console.warn("You need to provide a `parse` function as part of `dateFormatter`"),r.customFormatters&&r.customFormatters.dateFormatter&&r.customFormatters.dateFormatter.parse&&(e=String(r.customFormatters.dateFormatter.parse(t))),{res:!0,value:e}}}},714688:(t,e,s)=>{s.d(e,{DateTimeFormatter:()=>i});var r=s(716714),a=s(157954);const n={dateFormat:"yyyy-MM-dd",withWeekday:!1,timeFormat:r.hourMinuteSecondFormat,dateTimeSeparator:" "};class i{constructor(t={}){const e=Object.assign({},n,t);this._dateFormatter=new a.DateFormatter(e.dateFormat,e.withWeekday),this._timeFormatter=new r.TimeFormatter(e.timeFormat),this._separator=e.dateTimeSeparator}format(t){return`${this._dateFormatter.format(t)}${this._separator}${this._timeFormatter.format(t)}`}formatLocal(t){
return`${this._dateFormatter.formatLocal(t)}${this._separator}${this._timeFormatter.formatLocal(t)}`}}},534741:(t,e,s)=>{var r;s.d(e,{PlotRowSearchMode:()=>r}),function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.Exact=0]="Exact",t[t.NearestRight=1]="NearestRight"}(r||(r={}))},826989:(t,e,s)=>{var r;s.d(e,{SymbolErrorPermissionDeniedReason:()=>r,invalidSymbol:()=>n,permissionDenied:()=>a}),function(t){t.Symbol="symbol",t.GroupPermission="group"}(r||(r={}));const a="permission denied",n="invalid symbol"},459685:(t,e,s)=>{s.d(e,{unpackNonSeriesData:()=>i});var r=s(130551),a=s(650151);function n(t){if(!(0,r.isObject)(t))throw new Error("Graphics commands should be wrapped in an object");if((0,r.hasProperty)(t,"create"),(0,r.hasProperty)(t,"erase")){const e=t.erase;(0,a.assert)(Array.isArray(e),"Collection of erase commands should be array");for(const t of e){if(!(0,r.isObject)(t)||!(0,r.hasProperty)(t,"action"))throw new Error("Command should be an object with 'action' property");(0,a.assert)("all"===t.action||"one"===t.action,"Erase command action should be 'all' or 'one'")}}return t}async function i(t){if(""===t)return null;const e=JSON.parse(t);if(!(0,r.isObject)(e)||"function"==typeof e)throw new Error("Non-object content in the non-series envelope");if((0,r.hasProperty)(e,"indexes_replace"))return{indexes_replace:!0};const a={indexes_replace:!1};if((0,r.hasProperty)(e,"offsets")&&(a.offsets=e.offsets),(0,r.hasProperty)(e,"isUpdate")){if("boolean"!=typeof e.isUpdate)throw new Error('Invalid type of "isUpdate" field');a.isUpdate=e.isUpdate}if((0,r.hasProperty)(e,"data")&&(a.data=e.data),(0,r.hasProperty)(e,"graphicsCmds")&&(a.graphicsCmds=n(e.graphicsCmds)),(0,r.hasProperty)(e,"dataCompressed")||(0,r.hasProperty)(e,"graphicsCmdsCompressed")){const{default:t}=await Promise.all([s.e(93194),s.e(81578)]).then(s.t.bind(s,593194,23));if((0,r.hasProperty)(e,"dataCompressed")){const s=await(new t).loadAsync(e.dataCompressed,{base64:!0});a.data=JSON.parse(await s.file("").async("text"))}if((0,r.hasProperty)(e,"graphicsCmdsCompressed")){const s=await(new t).loadAsync(e.graphicsCmdsCompressed,{base64:!0});a.graphicsCmds=n(JSON.parse(await s.file("").async("text")))}return a}return a}},195447:(t,e,s)=>{s.d(e,{PlotList:()=>c});var r=s(650151),a=s(674981),n=s(732149),i=s(201089),o=s(534741);const l=(0,i.getLogger)("Chart.PlotList"),h=30;function d(t){return t.index}function u(t){return t.value[0]}class c{constructor(t=null,e=null){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache=new Map,this._rowSearchCacheByIndex=new Map,this._rowSearchCacheByIndexWithoutEmptyValues=new Map,this._rowSearchCacheByTime=new Map,this._rowSearchCacheByTimeWithoutEmptyValues=new Map,this._plotFunctions=t||new Map,this._emptyValuePredicate=e}clear(){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache.clear(),this._invalidateSearchCaches()}first(){return this.size()>0?this._items[this._start]:null}last(){return this.size()>0?this._items[this._end-1]:null}firstIndex(){
return this.size()>0?this._indexAt(this._start):null}lastIndex(){return this.size()>0?this._indexAt(this._end-1):null}size(){return this._end-this._start}isEmpty(){return 0===this.size()}contains(t){return null!==this.search(t,o.PlotRowSearchMode.Exact)}valueAt(t){const e=this.search(t);return null!==e?e.value:null}add(t,e){if(this._shareRead)return l.logDebug("add: readonly collection modification attempt"),!1;const s={index:t,value:e},r=this._nonCachedSearch(t,o.PlotRowSearchMode.Exact,d);return this._invalidateSearchCaches(),null===r?(this._items.splice(this._lowerbound(t,d),0,s),this._start=0,this._end=this._items.length,!0):(this._items[r]=s,!1)}search(t,e=o.PlotRowSearchMode.Exact,s){return this._searchImpl(t,e,this._rowSearchCacheByIndex,this._rowSearchCacheByIndexWithoutEmptyValues,d,s)}searchByTime(t,e=o.PlotRowSearchMode.Exact,s){return this._searchImpl(t,e,this._rowSearchCacheByTime,this._rowSearchCacheByTimeWithoutEmptyValues,u,s)}fold(t,e){let s=e;for(let e=this._start;e<this._end;++e){s=t(this._indexAt(e),this._valueAt(e),s)}return s}findFirst(t,e){const s=void 0!==e&&Math.min(this._start+e,this._end)||this._end;for(let e=this._start;e<s;++e){const s=this._indexAt(e),r=this._valueAt(e);if(t(s,r))return{index:s,value:r}}return null}findLast(t,e){const s=void 0!==e&&Math.max(this._end-e,this._start)||this._start;for(let e=this._end-1;e>=s;--e){const s=this._indexAt(e),r=this._valueAt(e);if(t(s,r))return{index:s,value:r}}return null}each(t){for(let e=this._start;e<this._end;++e){if(t(this._indexAt(e),this._valueAt(e)))break}}reduce(t,e){let s=e;for(let e=this._start;e<this._end;++e){s=t(s,this._indexAt(e),this._valueAt(e))}return s}range(t,e){const s=new c(this._plotFunctions,this._emptyValuePredicate);return s._items=this._items,s._start=this._lowerbound(t,d),s._end=this._upperbound(e),s._shareRead=!0,s}plottableRange(t){const e=new c(this._plotFunctions,this._emptyValuePredicate);return e._items=this._items,e._start=this._upperbound(n.UNPLOTTABLE_TIME_POINT_INDEX),e._end=this._end,e._shareRead=!0,!0===t&&e._start>this._start&&(e._start-=1),e}rangeCountback(t,e){if(null===this.firstIndex())return new c;const s=new c(this._plotFunctions,this._emptyValuePredicate);return s._items=this._items,s._end=this._upperbound(t),s._start=Math.max(this._start,s._end-e),s._shareRead=!0,s}rangeIterator(t,e){const s=this._lowerbound(t,d),r=this._upperbound(e);return this._rangeIteratorImpl(s,r)}fullRangeIterator(){return this._rangeIteratorImpl(this._start,this._end)}minMaxOnRangeCached(t,e,s){if(this.isEmpty())return null;let r=null;for(const a of s){r=m(r,this._minMaxOnRangeCachedImpl(t-a.offset,e-a.offset,a.name))}return r}minMaxOnRange(t,e,s){if(this.isEmpty())return null;let r=null;for(const a of s){r=m(r,this._minMaxOnRange(t-a.offset,e-a.offset,a.name))}return r}merge(t){return this._shareRead?(l.logDebug("merge: readonly collection modification attempt"),
null):0===t.length?null:this.isEmpty()||t[t.length-1].index<this._items[0].index?this._prepend(t):t[0].index>this._items[this._items.length-1].index?this._append(t):1===t.length&&t[0].index===this._items[this._items.length-1].index?(this._updateLast(t[0]),t[0]):this._merge(t)}addTail(t,e=!1){if(0===t.length)return;let s=0;e&&this._end-this._start>0&&(s=1,this._items[this._end-this._start-1].value=t[0].value);for(let e=s;e<t.length;++e){const s=t[e],r=this.lastIndex();if(null===r){l.logError("Can't add tail to the empty plotlist");break}this.add(r+1,s.value)}this._invalidateSearchCaches()}move(t){if(this._shareRead)return void l.logDebug("move: readonly collection modification attempt");if(0===t.length)return;const e=this._items.slice();for(const s of t){const t=this._bsearch(s.old,d);if(null!==t&&void 0!==e[t])if(s.new===n.INVALID_TIME_POINT_INDEX)e[t]=void 0;else{e[t]={index:s.new,value:e[t].value};const r=this._bsearch(s.new,d);if(null!==r){const t=e[r];void 0!==t&&t.index===s.new&&(e[r]=void 0)}}}this._items=e.filter((t=>void 0!==t)).sort(((t,e)=>t.index-e.index)),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._start=0,this._end=this._items.length}remove(t){if(this._shareRead)return l.logDebug("remove: readonly collection modification attempt"),null;const e=this._nonCachedSearch(t,o.PlotRowSearchMode.NearestRight,d);if(null===e)return null;const s=this._items.splice(e);return this._end=this._items.length,this._minMaxCache.clear(),this._invalidateSearchCaches(),s.length>0?s[0]:null}state(){const t=this._items.slice(this._start,this._end);return{start:0,end:t.length,data:t}}restoreState(t){t?(this._start=t.start,this._end=t.end,this._shareRead=!1,this._items=t.data,this._minMaxCache.clear(),this._invalidateSearchCaches()):this.clear()}_indexAt(t){return this._items[t].index}_valueAt(t){return this._items[t].value}_length(){return this._items.length}_searchImpl(t,e,s,r,a,n){const i=void 0!==n?s:r,o=void 0!==n?1e4*(e+1)+n:e;let l=i.get(t);if(void 0!==l){const t=l.get(o);if(void 0!==t)return t}const h=this._nonCachedSearch(t,e,a,n);if(null===h)return null;const d={index:this._indexAt(h),value:this._valueAt(h)};return void 0===l&&(l=new Map,i.set(t,l)),l.set(o,d),d}_nonCachedSearch(t,e,s,r){const a=this._lowerbound(t,s),n=a===this._end||t!==s(this._items[a]);if(n&&e!==o.PlotRowSearchMode.Exact)switch(e){case o.PlotRowSearchMode.NearestLeft:return this._searchNearestLeft(a,r);case o.PlotRowSearchMode.NearestRight:return this._searchNearestRight(a,r);default:throw new TypeError("Unknown search mode")}if(void 0===r||n||e===o.PlotRowSearchMode.Exact)return n?null:a;switch(e){case o.PlotRowSearchMode.NearestLeft:return this._nonEmptyNearestLeft(a,r);case o.PlotRowSearchMode.NearestRight:return this._nonEmptyNearestRight(a,r);default:throw new TypeError("Unknown search mode")}}_nonEmptyNearestRight(t,e){const s=(0,r.ensure)(this._emptyValuePredicate),a=(0,r.ensure)(e);for(;t<this._end&&s(this._valueAt(t),a);)t+=1;return t===this._end?null:t}_nonEmptyNearestLeft(t,e){const s=(0,
r.ensureNotNull)(this._emptyValuePredicate),a=(0,r.ensure)(e);for(;t>=this._start&&s(this._valueAt(t),a);)t-=1;return t<this._start?null:t}_searchNearestLeft(t,e){if(t===this._start)return null;const s=t-1,r=s!==this._end?s:null;return void 0!==e&&null!==r?this._nonEmptyNearestLeft(r,e):r}_searchNearestRight(t,e){const s=t,r=s!==this._end?s:null;return void 0!==e&&null!==r?this._nonEmptyNearestRight(r,e):r}_bsearch(t,e){const s=this._lowerbound(t,e);return s!==this._end&&t===e(this._items[s])?s:null}_lowerbound(t,e){return(0,a.lowerbound)(this._items,t,((t,s)=>e(t)<s),this._start,this._end)}_upperbound(t){return(0,a.upperbound)(this._items,t,((t,e)=>e.index>t),this._start,this._end)}_plotMinMax(t,e,s){let r=null;const a=this._plotFunctions.get(s);if(void 0===a)throw new Error(`Plot "${s}" is not registered`);for(let s=t;s<e;s++){const t=a(this._items[s].value);null==t||Number.isNaN(t)||(null===r?r={min:t,max:t}:(t<r.min&&(r.min=t),t>r.max&&(r.max=t)))}return r}_invalidateCacheForRow(t){const e=Math.floor(t.index/h);this._minMaxCache.forEach((t=>t.delete(e)))}_prepend(t){return(0,r.assert)(!this._shareRead,"collection should not be readonly"),(0,r.assert)(0!==t.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=t.concat(this._items),this._start=0,this._end=this._items.length,t[0]}_append(t){return(0,r.assert)(!this._shareRead,"collection should not be readonly"),(0,r.assert)(0!==t.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=this._items.concat(t),this._start=0,this._end=this._items.length,t[0]}_updateLast(t){(0,r.assert)(!this.isEmpty(),"plot list should not be empty");const e=this._items[this._end-1];(0,r.assert)(e.index===t.index,"last row index should match new row index"),this._invalidateCacheForRow(t),this._invalidateSearchCaches(),this._items[this._end-1]=t}_merge(t){return(0,r.assert)(0!==t.length,"plot rows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=function(t,e){const s=function(t,e){const s=t.length,r=e.length;let a=s+r,n=0,i=0;for(;n<s&&i<r;)t[n].index<e[i].index?n++:t[n].index>e[i].index?i++:(n++,i++,a--);return a}(t,e),r=new Array(s);let a=0,n=0;const i=t.length,o=e.length;let l=0;for(;a<i&&n<o;)t[a].index<e[n].index?(r[l]=t[a],a++):t[a].index>e[n].index?(r[l]=e[n],n++):(r[l]=e[n],a++,n++),l++;for(;a<i;)r[l]=t[a],a++,l++;for(;n<o;)r[l]=e[n],n++,l++;return r}(this._items,t),this._start=0,this._end=this._items.length,t[0]}_minMaxOnRangeCachedImpl(t,e,s){if(this.isEmpty())return null;let a=null;const n=(0,r.ensureNotNull)(this.firstIndex()),i=(0,r.ensureNotNull)(this.lastIndex()),o=Math.max(t,n),l=Math.min(e,i),d=Math.ceil(o/h)*h,u=Math.max(d,Math.floor(l/h)*h);a=m(a,this._minMaxOnRange(o,Math.min(d,e,l),s));let c=this._minMaxCache.get(s);void 0===c&&(c=new Map,this._minMaxCache.set(s,c));for(let t=Math.max(d+1,o);t<u;t+=h){const e=Math.floor(t/h);let r=c.get(e);if(void 0===r){const t=e*h,a=(e+1)*h-1;r=this._minMaxOnRange(t,a,s),c.set(e,r)}
a=m(a,r)}a=m(a,this._minMaxOnRange(u,l,s));return a}_minMaxOnRange(t,e,s){return this._plotMinMax(this._lowerbound(t,d),this._upperbound(e),s)}_rangeIteratorImpl(t,e){let s=t-1;return{[Symbol.iterator](){return this},next:()=>(s+=1,s>=e?{done:!0,value:void 0}:{done:!1,value:this._items[s]})}}_invalidateSearchCaches(){this._rowSearchCacheByIndex.clear(),this._rowSearchCacheByIndexWithoutEmptyValues.clear(),this._rowSearchCacheByTime.clear(),this._rowSearchCacheByTimeWithoutEmptyValues.clear()}}function m(t,e){if(null===t)return e;if(null===e)return t;return{min:Math.min(t.min,e.min),max:Math.max(t.max,e.max)}}},544421:(t,e,s)=>{s.d(e,{SeriesData:()=>c});var r,a=s(650151),n=s(195447),i=s(674981);!function(t){t[t.FromLeft=-1]="FromLeft",t[t.FromRight=1]="FromRight"}(r||(r={}));const o={open:t=>t[1],high:t=>t[2],low:t=>t[3],close:t=>t[4],hl2:t=>(t[2]+t[3])/2,hlc3:t=>(t[2]+t[3]+t[4])/3,ohlc4:t=>(t[1]+t[2]+t[3]+t[4])/4},l=["open","high","low","close","hl2","hlc3","ohlc4"];function h(){const t=new Map;return l.forEach(((e,s)=>{t.set(e,function(t,e,s){const r=o[null!=e?e:t],a=o[t],n=o[null!=s?s:t];return(t,e)=>{switch(e){case 0:return r(t);case 2:return n(t);default:return a(t)}}}(e))})),t}function d(t,e){return null==t[e]}const u=[{barsToMerge:10,forBarspacingLargerThen:.03},{barsToMerge:30,forBarspacingLargerThen:.01},{barsToMerge:100,forBarspacingLargerThen:.003},{barsToMerge:500,forBarspacingLargerThen:0}];class c{constructor(){this._pressedChunks={chunks:new Map,priceSource:"uninitialized"},this.m_bars=new n.PlotList(h(),d),this.m_nsBars=new n.PlotList(h(),d),this._clearPressedChunks()}bars(){return this.m_bars}nsBars(){return this.m_nsBars}pressedChunks(t,e){if(e!==this._pressedChunks.priceSource){this._pressedChunks.priceSource=e;const t=this.m_bars.first();t&&(this._clearPressedChunks(),this._rebuildPressedChunks(t))}const s=(0,a.ensureDefined)(u.find((e=>e.forBarspacingLargerThen<=t)));return(0,a.ensureDefined)(this._pressedChunks.chunks.get(s.barsToMerge))}mergeRegularBars(t){const e=this.m_bars.size(),s=this.m_bars.merge(t);return s&&"uninitialized"!==this._pressedChunks.priceSource&&(e===this.m_bars.size()&&s.index===this.m_bars.lastIndex()?this._updateLatestChunks():this._rebuildPressedChunks(s)),s}size(){return this.m_bars.size()+this.m_nsBars.size()}each(t){this.m_bars.each(t),this.m_nsBars.each(t)}clear(){this.m_bars.clear(),this.m_nsBars.clear(),this.lastProjectionPrice=void 0,this._clearPressedChunks()}isEmpty(){return this.m_bars.isEmpty()&&this.m_nsBars.isEmpty()}first(){return this.m_bars.isEmpty()?this.m_nsBars.first():this.m_bars.first()}last(){return this.m_nsBars.isEmpty()?this.m_bars.last():this.m_nsBars.last()}search(t,e,s){return this.nsBars().isEmpty()?this.bars().search(t,e,s):this.bars().isEmpty()||(0,a.ensureNotNull)(this.nsBars().firstIndex())<=t?this.nsBars().search(t,e,s):this.bars().search(t,e,s)}valueAt(t){const e=this.search(t);return null!==e?e.value:null}plotValueToTimePointIndex(t,e,s){if(s===r.FromRight){const s=(s,r)=>{const a=r[e];return null!=a&&t>=a},r=this.m_bars.findLast(s)
;if(null!==r)return r.index;const a=this.m_nsBars.findLast(s);return null!==a?a.index:this.m_bars.firstIndex()}if(s===r.FromLeft){const s=(s,r)=>{const a=r[e];return null!=a&&t<=a},r=this.m_bars.findFirst(s);if(null!==r)return r.index;const a=this.m_nsBars.findFirst(s);return null!==a?a.index:this.m_bars.lastIndex()}throw new Error("plotValueToTimePointIndex: unsupported search mode")}moveData(t){this.m_bars.move(t),this.m_nsBars.move(t),this.m_bars.size()>0&&this._rebuildPressedChunks((0,a.ensureNotNull)(this.m_bars.first()))}_rebuildPressedChunks(t){const e=this._pressedChunks.priceSource;if("uninitialized"===e)return;const s=t.index,r=o[e],n=(t,e,s)=>{let a=null;for(const n of t){const t=r(n.value);a&&n.index-a.startTime>=s.barsToMerge&&(e.push(a),a=null),a?(a.endTime=n.index,a.high=Math.max(a.high,t),a.low=Math.min(a.low,t),a.close=t):a={startTime:n.index,endTime:n.index,open:t,high:t,low:t,close:t}}a&&e.push(a)};u.forEach((t=>{const e=(0,a.ensureDefined)(this._pressedChunks.chunks.get(t.barsToMerge)),r=(0,i.lowerbound)(e,s,((t,e)=>t.endTime<e));if(0===r&&e.length>0){const s=e[0].startTime-1,r=(0,a.ensureNotNull)(this.m_bars.firstIndex()),i=this.m_bars.rangeIterator(r,s),o=[];n(i,o,t);const l=o.concat(e);this._pressedChunks.chunks.set(t.barsToMerge,l)}else{const s=(0,a.ensureNotNull)(this.m_bars.lastIndex());e.splice(r);let i=(0,a.ensureNotNull)(this.m_bars.firstIndex());e.length&&(i=e[e.length-1].endTime+1);const o=this.m_bars.rangeIterator(i,s);n(o,e,t)}}))}_updateLatestChunks(){const t=(0,a.ensureNotNull)(this.m_bars.last());u.forEach((e=>{const s=(0,a.ensureDefined)(this._pressedChunks.chunks.get(e.barsToMerge)),r=t.value[4],n=s[s.length-1];n.high=Math.max(n.high,r),n.low=Math.min(n.low,r),n.close=r,n.endTime=t.index}))}_clearPressedChunks(){u.forEach((t=>this._pressedChunks.chunks.set(t.barsToMerge,[])))}}},175878:(t,e,s)=>{s.d(e,{SeriesDataSource:()=>w});var r=s(650151),a=s(389137),n=s(919892),i=s(223699),o=s(544421),l=s(459685),h=s(826989),d=s(442410),u=s(201089),c=s(444331),m=s(25e4);const _=(0,u.getLogger)("Chart.SeriesDataSource");var f;!function(t){t[t.Idle=0]="Idle",t[t.AwaitingConnection=1]="AwaitingConnection",t[t.AwaitingFirstDataUpdate=2]="AwaitingFirstDataUpdate",t[t.Active=3]="Active"}(f||(f={}));let g=1;let p=1;function b(t){return t.startDate?t.endDate||t.count?t.endDate?["from_to",t.startDate,t.endDate]:["bar_count",t.startDate,(0,r.ensure)(t.count)]:["from_to",t.startDate]:t.count||300}function y(t){return(0,a.isString)(t.symbol)?t.symbol:t.symbol.symbol}function v(t,e){(0,a.isString)(t.symbol)?t.symbol=e:t.symbol.symbol=e}class w{constructor(t,e,s,r){this._extSymbol=null,this._lastResolvedSymbol="",this._createSeriesOverriddenParams=0,this._instanceId=null,this._symbolInstanceId=null,this._resolution=null,this._timeFrame=null,this._data=new o.SeriesData,this._dataEvents=new d.SeriesDataEvents,this._status=f.Idle,this._turnaroundCounter=1,this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=t,
this._turnaroundPrefix=e,this._createSeriesParams=b(null!=s?s:{count:300}),this._timeFrame=r||null,this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged)}modifySeries(t,e,s=null,n=!1,o=null){n&&(_.logNormal("Due to force flag clearing symbol & resolution to force re-requesting data."),this._extSymbol=null,this._resolution=null);const l=y(t),h=!this.symbolSameAsResolved(l);if(h&&(this._lastResolvedSymbol=""),this._extSymbol&&!h){v(t,y(this._extSymbol))}const d=this._extSymbol,u=this._resolution;if(this._extSymbol=t,this._resolution=e,null===this._instanceId)return void(this._timeFrame=s);const c=!(0,a.deepEquals)(d,t)[0];c&&v(this._extSymbol,l);const m=null===u||!i.Interval.isEqual(u,e);(c||m||null!==s)&&(this._timeFrame=null,(c||m)&&this._turnaroundCounter++,c&&this._resolveSymbol(),this._gateway.modifySeries(this._instanceId,this.turnaround(),(0,r.ensureNotNull)(this._symbolInstanceId),this._resolution,o,s,this._onMessage.bind(this)),this._dataEvents.fireModified())}requestMoreData(t){null!==this._instanceId&&this._gateway.requestMoreData(this._instanceId,t,this._onMessage.bind(this))}requestMoreTickmarks(t){null!==this._instanceId&&this._gateway.requestMoreTickmarks(this._instanceId,t,this._onMessage.bind(this))}isStarted(){return this._status!==f.Idle}isActive(){return this._status===f.Active}resolution(){return this._resolution}start(){this.isStarted()?_.logNormal("start: data source is already started, nothing to do"):((0,r.assert)(null!==this._extSymbol,"symbol must be set before start"),(0,r.assert)(null!==this._resolution,"resolution must be set before start"),this._gateway.isConnected().value()?this._createSeries():this._changeStatusTo(f.AwaitingConnection))}stop(){this.isStarted()?(null!==this._instanceId&&(this._gateway.removeSeries(this._instanceId),this._instanceId=null),this._symbolInstanceId=null,this._changeStatusTo(f.Idle)):_.logNormal("stop: data source is already stopped, nothing to do")}instanceId(){return this._instanceId}data(){return this._data}clearData(){this.isStarted()?this._enqueueUpdate((()=>this._clearDataImpl())):this._clearDataImpl()}dataEvents(){return this._dataEvents}turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}symbolInstanceId(){return this._symbolInstanceId}symbol(){return this._extSymbol}moveData(t){this._enqueueUpdate((()=>this._data.moveData(t)))}setInitialRequestOptions(t){this._createSeriesOverriddenParams=b(t)}symbolSameAsResolved(t){return null!==this._extSymbol&&(0,m.symbolSameAsResolved)(t,y(this._extSymbol),this._lastResolvedSymbol)}resolvedSymbol(){return null===this._extSymbol?null:y(this._extSymbol)}_resolveSymbol(){null!==this._extSymbol&&(this._symbolInstanceId=this._gateway.resolveSymbol("sds_sym_"+g++,(0,n.encodeExtendedSymbolOrGetSimpleSymbolString)(this._extSymbol),this._onMessage.bind(this)))}_clearDataImpl(){this._data.clear()}_changeStatusTo(t){(0,
r.assert)(this._status!==t,"Source and destination status should be distinct"),_.logNormal(`Status changed from ${f[this._status]} to ${f[t]}`),this._status=t}_createSeries(){(0,r.assert)(this._status!==f.Active,'Status should not be "Active" when creating a study'),this._instanceId="sds_"+p++,this._resolveSymbol();const t=this._createSeriesOverriddenParams||this._createSeriesParams;this._createSeriesOverriddenParams&&(this._createSeriesOverriddenParams=0),this._gateway.createSeries(this._instanceId,this.turnaround(),(0,r.ensureNotNull)(this._symbolInstanceId),(0,r.ensureNotNull)(this._resolution),t,this._timeFrame,this._onMessage.bind(this)),this._timeFrame=null,this._changeStatusTo(f.AwaitingFirstDataUpdate),this._dataEvents.fireCreated(this._instanceId)}_onGatewayIsConnectedChanged(t){t?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===f.AwaitingConnection&&this._createSeries()}_onGatewayDisconnected(){this._status!==f.Idle&&this._status!==f.AwaitingConnection&&(this._instanceId=null,this._changeStatusTo(f.AwaitingConnection)),this._turnaroundCounter=1}_onMessage(t){this._enqueueUpdate((()=>this._onMessageImpl(t)))}async _onMessageImpl(t){switch(t.method){case"symbol_resolved":{const[e,s]=t.params;if(e!==this._symbolInstanceId){null!==this._symbolInstanceId&&_.logNormal(`Resolve for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolResolved(s);break}case"symbol_error":if(t.params[0]!==this._symbolInstanceId){null!==this._symbolInstanceId&&_.logNormal(`Symbol error for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolError(t);break;case"series_timeframe":{const[e,s,r,a,n,i,o]=t.params;if(!this._checkTurnaround(e,s)){_.logNormal(`Time frame for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesTimeFrame(r,a,n,i,o);break}case"series_error":{const[e,s]=t.params;if(!this._checkTurnaround(e,s)){_.logNormal(`Series error for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesError(t.params[2]);break}case"series_loading":{const[e,s]=t.params;if(!this._checkTurnaround(e,s))break;this._onSeriesLoading(t.time);break}case"series_completed":{const[e,s,r,a]=t.params;if(!this._checkTurnaround(e,r)){_.logNormal(`Series completed for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${r})`);break}this._onSeriesCompleted(s,t.time,a);break}case"data_update":if(!this._checkTurnaround(t.params.customId,t.params.turnaround)){_.logNormal(`Data update for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t.params.customId} (${t.params.turnaround})`);break}await this._onDataUpdate(t.params.plots,t.params.nonseries,t.params.lastBar);break;case"clear_data":if(t.params.turnaround!==this.turnaround()){_.logNormal(`Clear data for old data, expected: ${this.turnaround()}, actual ${t.params.turnaround}`);break}this._clearDataImpl(),
this._dataEvents.fireDataUpdated(void 0,!1,null,!1)}}_onSeriesError(t){let e,s;if("string"==typeof t)s={error:t},e=t;else if(s=t,t.ctx){const s={};Object.entries(t.ctx).forEach((([t,e])=>{s[t]=e.toString()})),e=t.error.format(s)}else e=t.error;if(e.startsWith("study_not_auth:")){const t=e.split(":",2)[1].split("@",2)[0];if(["BarSetRenko","BarSetPriceBreak","BarSetKagi","BarSetPnF"].includes(t))this._dataEvents.fireChartTypeNotPermitted(t);else if("BarSetSpread"===t)this._dataEvents.fireIntradaySpreadNotPermitted();else if("BarSetRange"===t){const t=`${(0,r.ensureNotNull)(this._extSymbol).inputs.range}R`;this._dataEvents.fireCustomIntervalNotPermitted(t)}}else"resolution_not_entitled"===e?this._dataEvents.fireIntradayExchangeNotPermitted():"custom_resolution"===e?this._dataEvents.fireCustomIntervalNotPermitted((0,r.ensureNotNull)(this._resolution)):"seconds_not_entitled"===e?this._dataEvents.fireSecondsIntervalNotPermitted():"ticks_not_entitled"===e&&this._dataEvents.fireTicksIntervalNotPermitted();this._dataEvents.fireSeriesError(s)}_onSeriesTimeFrame(t,e,s,r,a){this._dataEvents.fireSeriesTimeFrame(t,e,s,null==r||r,a)}_onSymbolError(t){if(t.params[1]===h.permissionDenied)switch(t.params[2]){case h.SymbolErrorPermissionDeniedReason.Symbol:this._dataEvents.fireSymbolNotPermitted(t.params[3]);break;case h.SymbolErrorPermissionDeniedReason.GroupPermission:this._dataEvents.fireSymbolGroupNotPermitted(t.params[3]);break;default:this._dataEvents.fireSymbolNotPermitted(t.params[2])}else t.params[1]===h.invalidSymbol&&this._dataEvents.fireSymbolInvalid();this._dataEvents.fireSymbolError(t.params[1])}_onSymbolResolved(t){this._lastResolvedSymbol=(0,r.ensureNotNull)((0,c.extractSymbolNameFromSymbolInfo)(t,"")),this._dataEvents.fireSymbolResolved(t)}async _onDataUpdate(t,e,s){this._onDataUnpacked(t,s,await async function(t){if(void 0===t)return{projectionPlots:[],boxSize:null};if(""===t.d||"nochange"===t.indexes)return null;const e=await(0,l.unpackNonSeriesData)(t.d);if(null===e||e.indexes_replace)return null;const s=t.indexes,{bars:r,price:a,boxSize:n,reversalAmount:i}=e.data,o=(r||[]).map((t=>{let e;return"factor"in t?e=t.factor:"additionalPrice"in t&&(e=t.additionalPrice),{index:s[t.time],value:[0,t.open,t.high,t.low,t.close,t.volume,e]}}));return{lastPrice:a,projectionPlots:o,reversalAmount:i,boxSize:n}}(e))}_enqueueUpdate(t){return this._ongoingDataUpdate=this._ongoingDataUpdate.then(t,t),this._ongoingDataUpdate}_onDataUnpacked(t,e,s){if(this._status===f.Idle)return;this._status===f.AwaitingFirstDataUpdate&&(this._changeStatusTo(f.Active),this._clearDataImpl());const r=this._data.bars().size(),a=this._data.bars().firstIndex(),n=this._data.mergeRegularBars(t);null!==s&&(this._data.nsBars().clear(),this._data.nsBars().merge(s.projectionPlots),this._data.lastProjectionPrice=s.lastPrice,null!==s.boxSize&&(this._data.boxSize=s.boxSize),this._data.reversalAmount=s.reversalAmount);const i=null===a,o=i||null!==n&&n.index<a;this._dataEvents.fireDataUpdated(e,o,n,i),
r!==this._data.bars().size()&&null!==n&&this._dataEvents.fireBarReceived(n)}_onSeriesLoading(t){this._dataEvents.fireLoading(t)}_onSeriesCompleted(t,e,s){this._dataEvents.fireCompleted({updateMode:t,time:e,flags:s})}_checkTurnaround(t,e){return this._instanceId===t&&(void 0===e||e===this.turnaround())}}},25e4:(t,e,s)=>{function r(t,e,s){return t===e||t===s}s.d(e,{symbolSameAsResolved:()=>r})},732149:(t,e,s)=>{s.d(e,{INVALID_TIME_POINT_INDEX:()=>r,UNPLOTTABLE_TIME_POINT_INDEX:()=>a});const r=-2e6,a=-1e6},868073:(t,e,s)=>{function r(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}s.d(e,{regExpEscape:()=>r})}}]);